<?xml version="1.0" encoding="UTF-8" ?>
<UserControl
    x:Class="FluentPDF.App.Controls.ThumbnailsSidebar"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:local="using:FluentPDF.App.Controls"
    xmlns:models="using:FluentPDF.App.Models"
    xmlns:converters="using:FluentPDF.App.Converters"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    mc:Ignorable="d"
    x:Name="RootControl">

    <UserControl.Resources>
        <!-- Value Converters -->
        <converters:NullToVisibilityConverter x:Key="NullToVisibilityConverter" />
        <converters:BoolToVisibilityConverter x:Key="BoolToVisibilityConverter" />

        <!-- Data template for thumbnail items -->
        <DataTemplate x:Key="ThumbnailItemTemplate" x:DataType="models:ThumbnailItem">
            <Button
                Click="ThumbnailButton_Click"
                Background="Transparent"
                BorderThickness="0"
                Padding="0"
                HorizontalAlignment="Stretch"
                HorizontalContentAlignment="Stretch"
                Margin="0,4">
                <Grid Width="150" Height="220">
                    <!-- Selected border -->
                    <Border
                        BorderBrush="{ThemeResource AccentFillColorDefaultBrush}"
                        BorderThickness="3"
                        CornerRadius="4"
                        Visibility="{x:Bind IsSelected, Mode=OneWay, Converter={StaticResource BoolToVisibilityConverter}}"/>

                    <StackPanel Spacing="8">
                        <!-- Thumbnail container -->
                        <Grid Width="150" Height="190" Background="{ThemeResource CardBackgroundFillColorDefaultBrush}">
                            <!-- Thumbnail image -->
                            <Image
                                Source="{x:Bind Thumbnail, Mode=OneWay}"
                                Stretch="Uniform"
                                HorizontalAlignment="Center"
                                VerticalAlignment="Center"
                                Visibility="{x:Bind Thumbnail, Mode=OneWay, Converter={StaticResource NullToVisibilityConverter}}"/>

                            <!-- Loading placeholder -->
                            <Grid Visibility="{x:Bind IsLoading, Mode=OneWay, Converter={StaticResource BoolToVisibilityConverter}}">
                                <Rectangle Fill="{ThemeResource LayerFillColorDefaultBrush}"/>
                                <ProgressRing
                                    IsActive="{x:Bind IsLoading, Mode=OneWay}"
                                    Width="40"
                                    Height="40"
                                    HorizontalAlignment="Center"
                                    VerticalAlignment="Center"/>
                            </Grid>
                        </Grid>

                        <!-- Page number label -->
                        <TextBlock
                            Text="{x:Bind PageNumber, Mode=OneTime}"
                            HorizontalAlignment="Center"
                            Style="{StaticResource CaptionTextBlockStyle}"
                            Foreground="{ThemeResource TextFillColorSecondaryBrush}"/>
                    </StackPanel>
                </Grid>
            </Button>
        </DataTemplate>
    </UserControl.Resources>

    <Grid>
        <!-- ScrollViewer with ItemsRepeater -->
        <ScrollViewer
            x:Name="ThumbnailsScrollViewer"
            ViewChanged="ThumbnailsScrollViewer_ViewChanged"
            VerticalScrollBarVisibility="Auto"
            HorizontalScrollBarVisibility="Disabled">
            <ItemsRepeater
                x:Name="ThumbnailsRepeater"
                ItemsSource="{x:Bind ViewModel.Thumbnails, Mode=OneWay}"
                ItemTemplate="{StaticResource ThumbnailItemTemplate}"
                HorizontalAlignment="Center">
                <ItemsRepeater.Layout>
                    <StackLayout Orientation="Vertical" Spacing="4"/>
                </ItemsRepeater.Layout>
            </ItemsRepeater>
        </ScrollViewer>
    </Grid>
</UserControl>
