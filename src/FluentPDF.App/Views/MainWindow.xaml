<?xml version="1.0" encoding="UTF-8" ?>
<Window
    x:Class="FluentPDF.App.Views.MainWindow"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:local="using:FluentPDF.App.Views"
    xmlns:viewmodels="using:FluentPDF.App.ViewModels"
    xmlns:converters="using:FluentPDF.App.Converters"
    xmlns:controls="using:FluentPDF.App.Controls"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    mc:Ignorable="d">

    <Grid>
        <Grid.Resources>
            <converters:CountToVisibilityConverter x:Key="CountToVisibilityConverter" />
        </Grid.Resources>
        <Grid.RowDefinitions>
            <!-- Menu bar -->
            <RowDefinition Height="Auto" />
            <!-- Tab view -->
            <RowDefinition Height="*" />
        </Grid.RowDefinitions>

        <!-- Menu Bar -->
        <MenuBar Grid.Row="0">
            <MenuBarItem Title="File" AutomationProperties.AutomationId="FileMenuBarItem">
                <MenuFlyoutItem Text="Open..." Click="OnOpenFileClick" AutomationProperties.AutomationId="OpenMenuItem">
                    <MenuFlyoutItem.KeyboardAccelerators>
                        <KeyboardAccelerator Key="O" Modifiers="Control" />
                    </MenuFlyoutItem.KeyboardAccelerators>
                </MenuFlyoutItem>
                <MenuFlyoutSeparator />
                <MenuFlyoutItem x:Name="SaveMenuItem" Text="Save" Click="OnSaveClick" AutomationProperties.AutomationId="SaveMenuItem">
                    <MenuFlyoutItem.KeyboardAccelerators>
                        <KeyboardAccelerator Key="S" Modifiers="Control" />
                    </MenuFlyoutItem.KeyboardAccelerators>
                </MenuFlyoutItem>
                <MenuFlyoutItem x:Name="SaveAsMenuItem" Text="Save As..." Click="OnSaveAsClick" AutomationProperties.AutomationId="SaveAsMenuItem">
                    <MenuFlyoutItem.KeyboardAccelerators>
                        <KeyboardAccelerator Key="S" Modifiers="Control,Shift" />
                    </MenuFlyoutItem.KeyboardAccelerators>
                </MenuFlyoutItem>
                <MenuFlyoutSeparator />
                <MenuFlyoutSubItem x:Name="RecentFilesSubMenu" Text="Recent Files" AutomationProperties.AutomationId="RecentFilesSubMenu">
                    <!-- Dynamic recent files items will be added in code-behind -->
                </MenuFlyoutSubItem>
                <MenuFlyoutItem Text="Clear Recent Files..." Click="OnClearRecentFilesClick" AutomationProperties.AutomationId="ClearRecentFilesMenuItem" />
                <MenuFlyoutSeparator />
                <MenuFlyoutItem Text="Exit" Click="OnExitClick" AutomationProperties.AutomationId="ExitMenuItem" />
            </MenuBarItem>
            <MenuBarItem Title="Tools" AutomationProperties.AutomationId="ToolsMenuBarItem">
                <MenuFlyoutItem Text="Settings..." Click="OnSettingsClick" AutomationProperties.AutomationId="SettingsMenuItem" />
            </MenuBarItem>
        </MenuBar>

        <!-- Tab View -->
        <TabView
            Grid.Row="1"
            x:Name="MainTabView"
            AutomationProperties.AutomationId="MainTabView"
            TabItemsSource="{x:Bind ViewModel.Tabs, Mode=OneWay}"
            SelectedItem="{x:Bind ViewModel.ActiveTab, Mode=TwoWay}"
            CanDragTabs="True"
            CanReorderTabs="True"
            TabWidthMode="Equal"
            TabCloseRequested="OnTabCloseRequested"
            AddTabButtonClick="OnAddTabClick">

            <TabView.TabItemTemplate>
                <DataTemplate x:DataType="viewmodels:TabViewModel">
                    <TabViewItem
                        Header="{x:Bind DisplayName, Mode=OneWay}"
                        IsClosable="True">
                        <TabViewItem.IconSource>
                            <SymbolIconSource Symbol="Document" />
                        </TabViewItem.IconSource>

                        <!-- Tab Content: PdfViewerControl -->
                        <controls:PdfViewerControl ViewerViewModel="{x:Bind ViewerViewModel, Mode=OneWay}" />
                    </TabViewItem>
                </DataTemplate>
            </TabView.TabItemTemplate>

            <!-- Empty state when no tabs are open -->
            <TabView.TabStripHeader>
                <Grid />
            </TabView.TabStripHeader>

            <TabView.TabStripFooter>
                <Grid />
            </TabView.TabStripFooter>
        </TabView>

        <!-- Empty state overlay -->
        <Grid
            Grid.Row="1"
            x:Name="EmptyStateOverlay"
            Visibility="Visible">
            <StackPanel
                HorizontalAlignment="Center"
                VerticalAlignment="Center"
                Spacing="16">
                <SymbolIcon Symbol="Document" RenderTransformOrigin="0.5,0.5">
                    <SymbolIcon.RenderTransform>
                        <ScaleTransform ScaleX="3" ScaleY="3" />
                    </SymbolIcon.RenderTransform>
                </SymbolIcon>
                <TextBlock
                    Text="No PDFs open"
                    Style="{StaticResource SubtitleTextBlockStyle}"
                    HorizontalAlignment="Center" />
                <Button
                    Content="Open File"
                    Click="OnOpenFileClick"
                    AutomationProperties.AutomationId="EmptyStateOpenButton"
                    Style="{StaticResource AccentButtonStyle}" />
            </StackPanel>
        </Grid>
    </Grid>
</Window>
